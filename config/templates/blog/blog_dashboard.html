{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="row"> 
	<div class="col-lg-8 offset-lg-2 d-flex" style="display:flex; align-items:center; ">
		<h2 class="p-2">Article Dashboard</h2>
		<a class="btn btn-secondary btn-lg ml-auto p-2" href="{% url 'blog:create' %}" style="float: right;">Create new Article</a>
	</div>
</div>
<div class="row"> 
	<div class="col-lg-8 offset-lg-2">
		 <table id="article_table" class="table table-striped table-hover">
		    <thead>
		    	<tr>
		    		<th>Title</th>
					<th>Description</th>
					<th>Article Length</th>
					<th>Date Created</th>
					<th>Last Modified</th>
					<th>Date Published</th>
					<th>Actions</th>
					<th>&nbsp;</th>
					<th>&nbsp;</th>
		    	</tr>
		    </thead>
		    <tbody>
		    	{% for post in posts %}
		    		<tr>
		    			<td><a href="{% url 'blog:display' pk=post.id %}">{{post.title}}</a></td>
		    			<td style="max-width: 200px; word-wrap: break-word;">{{post.description}}</td>
		    			<td>{{post.read_length}}</td>
		    			<td>{{post.created|date:"m-d-Y"}}</td>
		    			<td>{{post.modified|date:"m-d-Y G:i"}}</td>
		    			<td>{{post.publish_date|date:"m-d-Y"}}</td>
		    			<td>
		    				<form method="POST" id="deleteForm">
		    					{% csrf_token %}
		    					<input type="hidden" name="action" value="delete">
		    					<input type="hidden" name="pk" value="{{post.id}}">
		    					<button class="btn btn-danger btn-sm" onclick="confirmDelete()" type="button">Delete</button>
		    				</form>
		    			</td>
		    			<td>
		    				
		    				<form method="POST">
		    					{% csrf_token %}
		    					<input type="hidden" name="action" value="publish">
		    					<input type="hidden" name="pk" value="{{post.id}}">
		    					{% if post.published %}
		    					<button class="btn btn-warning btn-sm">Unpublish</button>
		    					{% else %}
		    					<button class="btn btn-primary btn-sm">Publish</button>
		    					{% endif %}
		    				</form>
		    			</td>
		    			<td>
		    				<a href="{% url 'blog:edit' pk=post.id %}" class="btn btn-success btn-sm">Edit</a>
		    			</td>
		    		</tr>
		    		{% empty %}
		    		<tr>
		    			<td colspan="7" style="text-align: center"> No articles yet. Want to <a href="{% url 'blog:create' %}">create</a> one now?</td>
		    		</tr>
		    	{% endfor %}
		    </tbody>
		</table>
		
	</div>
</div>
{% endblock content %}

{% block js %}
<script type="text/javascript">
	$(function() {
        $("#loader_cover").addClass("toggled");
        $("#body").removeAttr("style");
        var table = $('#article_table').DataTable( {
	        responsive: true,
	        paging: false,
	        
	    } );
	 
	    new $.fn.dataTable.FixedHeader( table );
    })
	function confirmDelete() {
		$.confirm({
	        type: "red",
	        title: "Are you sure?",
	        content: "This action cannot be undone. Are you sure you want to continue?",
	        buttons: {
	            Yes: function() {
	                $('#deleteForm').submit()
	            },
	            Cancel: function() {

	            }
	        }
	    })
	}
</script>
{% endblock js %}