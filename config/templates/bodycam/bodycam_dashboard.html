{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Donut - KBP{% endblock %}


{% block content %}
<div class="row" id="app" v-cloak>
    <div class="col-lg-12">
        <div class="row" style="padding-top:15px; padding-bottom: 15px">
            <div class="col-lg-6" style="display:flex;align-items:center;">
                <a v-bind:href="calculatePreviousYear()" class="btn btn-secondary">View Previous Year's Data</a>
            </div>
            <div class="col-lg-6" style="display:flex;justify-content:flex-end;align-items:center;">
                <a v-if="year != currentYear" v-bind:href="calculateNextYear()" class="btn btn-secondary">View Following Year's Data</a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12" style="display:flex;justify-content:center;align-items:center;">
                <h1>{{year}} Bodycams</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12" style="display:flex;justify-content:center;align-items:center;">
                <h4>{{total}} Bodycams For This Year</h4>
            </div>
        </div>
        <div class="row">
		    <div class="col-lg-12">
		        <div class="card border-dark" style="margin-bottom:20px;">
			        <div class="card-header">Filters</div>
			        <div class="card-body">
			            <form>
			                <div class="form-group row">
			                	<div class="col-lg-4">
			                        <label for="text_text">Filter by text</label>
			                        <input id="text_text" type="text" class="form-control" placeholder="Matches to the title or to the description" v-model="text">
			                    </div>
			                    <div class="col-lg-4">
			                        <label for="race_select">Filter by race of suspect</label>
			                        <select id="race_select" class="form-control" style="width:100%" multiple="multiple">
			                            <option></option>
			                            <option v-for="race in races" v-bind:value="race.value">((race.display))</option>
			                        </select>
			                    </div>
			                    <div class="col-lg-4">
			                        <label for="tag_select">Filter by tag</label>
			                        <select id="tag_select" class="form-control" style="width:100%" multiple="multiple">
			                            <option></option>
			                            <option v-for="tag in all_tags" v-bind:value="tag.value">((tag.display))</option>
			                        </select>
			                    </div>
			                </div>
			                 <div class="form-group row">
			                    <div class="col-lg-4">
			                        <label for="state_select">Filter by state</label>
			                        <select id="state_select" class="form-control" style="width:100%" multiple="multiple">
			                            <option></option>
			                            <option v-for="state in states" v-bind:value="state.value">((state.display))</option>
			                        </select>
			                    </div>
			                    <div class="col-lg-4">
			                        <label for="city_text">Filter by city</label>
			                        <input id="city_text" type="text" class="form-control" placeholder="Partial and similar matches will be included." v-model="city">
			                    </div>
			                    <div class="col-lg-4">
			                        <label for="department_select">Filter by department</label>
			                        <select id="department_select" class="form-control" style="width:100%" multiple="multiple">
			                            <option></option>
			                            <option v-for="department in departments" v-bind:value="department.value">((department.display))</option>
			                        </select>
			                    </div>
			                </div>
			                <div class="form-group row">
			                    <div class="col-lg-4">
			                        <label for="text_text">Date on or after</label>
			                        <div class="input-group date" id="start_date" data-target-input="nearest">
			                            <input type="text" class="form-control datetimepicker-input" data-target="#start_date"/>
			                            <div class="input-group-append" data-target="#start_date" data-toggle="datetimepicker">
			                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
			                            </div>
			                        </div>
			                    </div>
			                    <div class="col-lg-4">
			                        <label for="text_text">Date on or before</label>
			                        <div class="input-group date" id="end_date" data-target-input="nearest">
			                            <input type="text" class="form-control datetimepicker-input" data-target="#end_date"/>
			                            <div class="input-group-append" data-target="#end_date" data-toggle="datetimepicker">
			                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
			                            </div>
			                        </div>
			                    </div>
			                    <div class="col-lg-4">
			                        <button type="button" class="btn btn-warning" v-on:click="resetFilters" style="margin-top:30px;">Reset Filters</button>
			                    </div>
			                </div>

			            </form>
			        </div>
		        </div>
		    </div>
		</div>
        <div class="row">
            <div class="col-lg-12">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr style="background-color:white;">
                            <th class="noselect" style="cursor: pointer;" v-on:click="order_by('title')">
                                Title 
                                <i class="fa fa-sort-asc" v-if="order.title == 1" aria-hidden="true"></i>
                                <i class="fa fa-sort-desc" v-if="order.title == -1" aria-hidden="true"></i>
                            </th>
                            <th class="noselect" style="cursor: pointer;" v-on:click="order_by('description')">
                                Description 
                                <i class="fa fa-sort-asc" v-if="order.description == 1" aria-hidden="true"></i>
                                <i class="fa fa-sort-desc" v-if="order.description == -1" aria-hidden="true"></i>
                            </th>
                            <th class="noselect" style="cursor: pointer;" v-on:click="order_by('department')">
                                Department 
                                <i class="fa fa-sort-asc" v-if="order.department == 1" aria-hidden="true"></i>
                                <i class="fa fa-sort-desc" v-if="order.department == -1" aria-hidden="true"></i>
                            </th>
                            <th class="noselect" style="cursor: pointer;" v-on:click="order_by('state')">
                                State 
                                <i class="fa fa-sort-asc" v-if="order.state == 1" aria-hidden="true"></i>
                                <i class="fa fa-sort-desc" v-if="order.state == -1" aria-hidden="true"></i>
                            </th>
                            <th class="noselect" style="cursor: pointer;" v-on:click="order_by('city')">
                                City 
                                <i class="fa fa-sort-asc" v-if="order.city == 1" aria-hidden="true"></i>
                                <i class="fa fa-sort-desc" v-if="order.city == -1" aria-hidden="true"></i>
                            </th>
                            <th>
                                Tags 
                            </th>
                            <th>
                                Details 
                            </th>
                            {% if user.is_authenticated %}
                            <th>
                                Admin Actions
                            </th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="shooting in displayed_shootings">
                            <td>
                                ((shooting.title))
                            </td>
                            <td>
                                ((displaydescription(shooting.description) ))
                            </td>
                            <td>
                                ((shooting.date))
                            </td>
                            <td>
                                ((shooting.race))
                            </td>
                            <td>
                                ((shooting.gender))
                            </td>
                            <td>
                                ((shooting.state))
                            </td>
                            <td>
                                ((shooting.city))
                            </td>
                            <td>
                                <span style="padding: 5px; margin-right: 5px" v-for="tag in shooting.tags" class="badge badge-primary">((tag.text))</span>
                            <td>
                                <button v-on:click="openDetails(shooting.id)" type="button" class="btn btn-sm btn-primary">Details</button>
                            </td>
                            {% if user.is_authenticated %}
                            <td>
                                <button v-on:click="editShooting(shooting.id)" type="button" class="btn btn-sm btn-primary">Edit</button>
                                <button v-on:click="deleteShooting(shooting.id)" type="button" class="btn btn-sm btn-danger"><i style="font-size:16px" class="fa fa-trash fa-2" aria-hidden="true"></i></button>
                            </td>
                            {% endif %}
                        </tr>
                        <tr v-show="shootings.length == 0">
                            {% if user.is_authenticated %}
                            <td colspan="10" style="text-align:center">
                                No shootings yet
                            </td>
                            {% else %}
                            <td colspan="9" style="text-align:center">
                                No shootings yet
                            </td>
                            {% endif %}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal" id="shooting_details" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">((displayed_shooting.title)), ((displayed_shooting.date))</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <h5>Donut's Take</h5>
                            <div v-if="displayed_shooting.video_url != 'None'" v-html="displayed_shooting.video_url"> </div>
                            <div v-else style="background-color:gray; width:100%; height:315px" class="d-flex flex-row    p-2 flex-column justify-content-center flex-fill">
                                <div class="align-self-center p-2"><h1 style="color:white;">No Video Available</h1></div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-lg-12">
                            <h5>Sources</h5>
                            <table class="table table-striped">
                                <tbody>
                                    <tr v-for="source in displayed_shooting.sources">
                                        <td style="max-width: 100px; word-wrap: break-word;"><a v-bind:href="source">((source))</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <h5>Further Details</h5>
                            <div style="height: 200px; overflow-y: scroll" v-if="displayed_shooting.description !== undefined && displayed_shooting.description.length != 0"  v-html="displayed_shooting.description">
                                
                            </div>
                            <p style="height:200px; overflow-y:scroll" v-else>No further details at this time.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block js %}
{% endblock js %}

