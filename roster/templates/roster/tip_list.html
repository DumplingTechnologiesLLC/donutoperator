{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block title %}Donut - KBP{% endblock %}

{% block css %}
<title>PeopleKilledByPolice: All tips submitted by to the data curating team on killings not present in the PKBP database</title>
{% endblock css %}


{% block content %}
<div class="row" style="padding-left:30px; margin-top: 30px; margin-bottom: 30px; padding-right: 50px">
    <div class="col-lg-12">
        <table id="table" class="table table-striped table-hover" >
            <thead>
                <tr style="background-color:white;">
                    <th class="noselect" style="cursor: pointer;" >
                        Date Submitted 
                    </th>
                    <th class="noselect" style="cursor: pointer;" >
                        Tip
                    </th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for tip in object_list %}
                    <tr>
                        <td>
                            {{tip.created|date:"D d M Y" }}
                        </td>
                        <td class="tiptext" style="white-space: pre-wrap; max-width:500px; overflow-x:scroll">
{{tip.text|safe}}
                        </td>
                        <td>
                            <input class="form-check-input" onclick="$(this).change(function() { if(this.checked) { array.push({{tip.id}}) } else { array = arrayRemove(array, {{tip.id}})} });" type="checkbox" value="" id="defaultCheck1">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <button class="btn btn-danger" id="submitButton" onclick="submitDeletes()">Delete Selected Tips</button>
    </div>
</div>
{% endblock content %}

{% block js %}
<script type="text/javascript">
    function submitDeletes() {
        $("#submitButton").prop("disabled", "disabled");
        uniqueIds = [];
        for (var x = 0; x < array.length; x++) {
            if (uniqueIds.indexOf(array[x] < 0) ) {
                uniqueIds.push(array[x])
            }
        }
        data = {
            csrfmiddlewaretoken: "{{csrf_token}}",
            tips: uniqueIds
        }
        $.post("{% url 'roster:tip-list' %}", data).done(function() {
            window.location.reload()
        })
    }
    function arrayRemove(arr, value) {
       return arr.filter(function(ele){
           return ele != value;
       });
    }
    var array = [];
    $(document).ready( function () {
        $(".tiptext").each(function() {
            var innerHTML = $(this).html().trim();
            innerHTML = innerHTML.replaceAll("\\n", "<br>")
            innerHTML = innerHTML.replaceAll("\\\"", "\"")
            $(this).html(innerHTML);
            console.log(innerHTML);
        })
        $('#table').DataTable({
            buttons: [
                {
                    text: 'My button',
                    action: function ( e, dt, node, config ) {
                        alert( 'Button activated' );
                    }
                }
            ]
        });
    } );
    $("#loader_cover").addClass("toggled");
    $("#body").removeAttr("style");
    String.prototype.replaceAll = function(search, replacement) {
        var target = this;
        return target.split(search).join(replacement);
    };
</script>
{% endblock js %}